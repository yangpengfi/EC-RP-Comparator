# 电子料替代与比价助手需求文档

## 1. 项目背景

### 1.1 项目简介
电子料替代与比价助手是一款基于Chrome浏览器的扩展插件，旨在帮助电子工程师、采购人员和研发团队快速查询电子元器件的替代料信息和跨平台价格比较，提高元器件选型效率，降低采购成本，减少供应链风险。

### 1.2 项目目标
- 提供便捷的电子料号查询功能
- 智能推荐替代料方案
- 实现多平台价格实时比较
- 提供元器件风险评估
- 优化用户查询体验

### 1.3 适用场景
- 电子工程师在设计阶段寻找替代料
- 采购人员进行价格比较和供应商选择
- 研发团队评估元器件供应链风险
- 电子爱好者查询元器件信息

## 2. 功能需求

### 2.1 核心功能

#### 2.1.1 料号查询功能
- **功能描述**：用户可通过右键菜单选择网页中的料号进行查询
- **触发方式**：右键选中网页中的料号文本，点击"查询料号: [选中文本]"菜单项
- **查询范围**：支持主流电子元器件料号格式
- **反馈机制**：显示加载状态，查询完成后展示结果弹窗

#### 2.1.2 替代料推荐
- **功能描述**：基于查询料号，推荐合适的替代料方案
- **推荐类型**：
  - 直接替代：功能完全一致，封装或品牌不同
  - 参数等效：主要参数一致，可兼容使用
  - 功能替代：功能类似，架构或封装不同
- **推荐来源**：芯查查、芯片智选、芯团AI等
- **差异说明**：清晰展示替代料与原料号的主要差异

#### 2.1.3 跨平台价格比较
- **功能描述**：展示同一料号在不同平台的价格、库存和交期信息
- **支持平台**：
  - 国内：立创商城、云汉芯城
  - 国外：DigiKey、Mouser、Arrow
- **排序规则**：默认按价格从低到高排序
- **跳转功能**：点击任意平台条目可直接跳转到对应平台的产品页面

#### 2.1.4 风险评估信息
- **功能描述**：提供元器件的生命周期、RoHS合规性等风险信息
- **展示内容**：
  - 生命周期状态（量产中、停产中、已停产）
  - RoHS合规状态（符合、不符合、未知）
  - 风险等级（正常、警告、高风险）

### 2.2 辅助功能

#### 2.2.1 自动料号识别
- **功能描述**：页面加载完成后自动识别网页中的料号
- **识别规则**：基于正则表达式匹配常见料号格式
- **反馈机制**：控制台输出识别到的料号，不影响页面显示

#### 2.2.2 缓存机制
- **功能描述**：对查询结果进行缓存，提高重复查询效率
- **缓存策略**：
  - 缓存时间：默认1小时
  - 缓存类型：内存缓存
  - 缓存管理：支持手动清除特定料号缓存或全部缓存

#### 2.2.3 错误处理
- **功能描述**：对查询过程中的错误进行捕获和处理
- **错误类型**：
  - 网络错误
  - API调用失败
  - 无效料号
- **反馈机制**：显示友好的错误提示弹窗

## 3. 非功能需求

### 3.1 性能需求
- **响应时间**：查询请求响应时间<2秒
- **并发处理**：支持1000+并发请求
- **页面加载**：扩展加载时间<100ms

### 3.2 可靠性需求
- **服务可用性**：99.9%以上
- **错误率**：API调用错误率<0.1%
- **数据准确性**：替代料推荐准确率>95%

### 3.3 安全性需求
- **数据传输**：使用HTTPS协议加密传输
- **权限控制**：仅申请必要的浏览器权限
- **数据存储**：敏感数据不本地存储
- **API密钥管理**：使用环境变量管理API密钥

### 3.4 兼容性需求
- **浏览器支持**：Chrome 90+，支持Manifest V3
- **操作系统**：Windows、macOS、Linux
- **分辨率支持**：自适应不同屏幕分辨率

### 3.5 可维护性需求
- **代码结构**：模块化设计，便于扩展和维护
- **日志记录**：完善的日志系统，便于问题排查
- **文档完整性**：代码注释率>30%

## 4. 用户角色与权限

### 4.1 用户角色
| 角色名称 | 角色描述 | 使用场景 |
|---------|---------|---------|
| 电子工程师 | 设计电路时查询替代料 | 选型设计阶段 |
| 采购人员 | 进行价格比较和供应商选择 | 采购决策阶段 |
| 研发团队 | 评估元器件供应链风险 | 项目规划阶段 |
| 电子爱好者 | 查询元器件信息 | 学习和制作阶段 |

### 4.2 权限管理
- 所有用户拥有相同的功能权限
- 无需登录即可使用所有功能
- 仅需Chrome浏览器扩展安装权限

## 5. 系统架构概述

### 5.1 系统总体架构
```
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│  Chrome扩展     │     │  后端代理服务   │     │  第三方API服务  │
│  ┌─────────────┐│     │  ┌─────────────┐│     │                 │
│  │  内容脚本   │├────▶│  │  API路由层  │├────▶│  - 芯查查API    │
│  └─────────────┘│     │  └─────────────┘│     │  - 芯片智选API  │
│  ┌─────────────┐│     │  ┌─────────────┐│     │  - DigiKey API  │
│  │  背景脚本   │├────▶│  │  数据处理层  │├────▶│  - Mouser API   │
│  └─────────────┘│     │  └─────────────┘│     │  - 云汉芯城API  │
│  ┌─────────────┐│     │  ┌─────────────┐│     │  - Arrow API    │
│  │  右键菜单   │├────▶│  │  缓存管理   ││     │                 │
│  └─────────────┘│     │  └─────────────┘│     └─────────────────┘
└─────────────────┘     └─────────────────┘
```

### 5.2 技术栈
- **前端**：Chrome扩展（Manifest V3）、原生JavaScript
- **后端**：Node.js、Express框架
- **缓存**：内存缓存
- **API通信**：RESTful API
- **数据格式**：JSON

## 6. 界面设计规范

### 6.1 设计原则
- 简洁明了：信息展示清晰，避免冗余
- 响应迅速：操作反馈及时，加载状态明确
- 易用性：交互流程简单，符合用户习惯
- 视觉统一：保持一致的设计风格和色彩方案

### 6.2 色彩规范
- 主色调：#1967d2（蓝色）
- 成功色：#188038（绿色）
- 警告色：#d97706（黄色）
- 错误色：#dc2626（红色）
- 背景色：#ffffff（白色）
- 边框色：#e2e8f0（浅灰色）

### 6.3 字体规范
- 标题字体：18px，600权重
- 正文字体：14px，400权重
- 辅助文字：12px，400权重
- 字体族：-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif

### 6.4 组件设计

#### 6.4.1 弹窗组件
- **尺寸**：最大宽度500px，最大高度80vh
- **圆角**：16px
- **阴影**：0 12px 48px rgba(0, 0, 0, 0.18)
- **动画**：滑入滑出动画，持续时间0.3s

#### 6.4.2 卡片组件
- **尺寸**：自适应父容器宽度
- **圆角**：12px
- **内边距**：20px
- **边框**：1px solid #e2e8f0

#### 6.4.3 按钮组件
- **尺寸**：根据内容自适应
- **圆角**：8px
- **内边距**：8px 20px
- **hover效果**：轻微放大和阴影变化

## 7. 数据流程说明

### 7.1 料号查询流程
1. 用户在网页中选中电子料号文本
2. 右键点击，选择"查询料号: [选中文本]"菜单项
3. 浏览器扩展发送查询请求到背景脚本
4. 背景脚本调用后端API，传入料号参数
5. 后端服务检查缓存，若缓存命中则直接返回结果
6. 若缓存未命中，后端服务调用多个第三方API获取数据
7. 后端服务整合数据，存入缓存，并返回给前端
8. 前端展示查询结果弹窗

### 7.2 数据处理流程
1. 后端服务接收到查询请求
2. 解析请求参数，验证料号格式
3. 调用缓存管理模块检查是否存在缓存数据
4. 若缓存存在且未过期，直接返回缓存数据
5. 若缓存不存在或已过期，调用各平台数据获取器
6. 数据获取器调用第三方API或返回模拟数据
7. 整合各平台数据，生成统一格式的响应
8. 将响应数据存入缓存
9. 返回响应数据给前端

## 8. 接口定义

### 8.1 后端API接口

#### 8.1.1 健康检查接口
- **URL**：`/health`
- **方法**：GET
- **功能**：检查后端服务运行状态
- **响应示例**：
  ```json
  {
    "status": "ok",
    "message": "代理服务运行正常",
    "timestamp": "2026-01-08T02:40:10.718Z",
    "version": "1.0.0",
    "cache": {
      "size": 0,
      "defaultTtl": 3600000
    },
    "api": {
      "platforms": 6,
      "lastCheck": "2026-01-08T02:40:10.718Z",
      "status": "all_available"
    }
  }
  ```

#### 8.1.2 料号查询接口
- **URL**：`/api/part/:partNumber`
- **方法**：GET
- **功能**：查询电子料号的替代料和价格信息
- **路径参数**：
  - `partNumber`：电子料号
- **响应示例**：
  ```json
  {
    "success": true,
    "data": {
      "partNumber": "ATMEGA328P-PU",
      "alternatives": [
        {
          "model": "ATMEGA328P-AU",
          "type": "直接替代",
          "source": "芯查查",
          "differences": "封装不同，功能完全一致"
        },
        {
          "model": "ATTINY85-20PU",
          "type": "参数等效",
          "source": "芯片智选",
          "differences": "引脚数量不同，部分功能兼容"
        }
      ],
      "prices": [
        {
          "platform": "立创商城",
          "price": "¥5.32",
          "stock": "5999",
          "leadTime": "现货"
        },
        {
          "platform": "DigiKey",
          "price": "$2.33",
          "stock": "5817",
          "leadTime": "现货"
        }
      ],
      "riskInfo": {
        "lifecycle": "量产中",
        "rohs": "符合",
        "status": "正常"
      }
    }
  }
  ```

#### 8.1.3 清除缓存接口
- **URL**：`/cache/:partNumber`
- **方法**：DELETE
- **功能**：清除特定料号的缓存数据
- **路径参数**：
  - `partNumber`：电子料号
- **响应示例**：
  ```json
  {
    "success": true,
    "message": "缓存已清除"
  }
  ```

#### 8.1.4 清除全部缓存接口
- **URL**：`/cache`
- **方法**：DELETE
- **功能**：清除所有料号的缓存数据
- **响应示例**：
  ```json
  {
    "success": true,
    "message": "全部缓存已清除"
  }
  ```

### 8.2 浏览器扩展内部通信

#### 8.2.1 右键菜单点击事件
- **发送方**：浏览器扩展右键菜单
- **接收方**：背景脚本
- **数据格式**：
  ```json
  {
    "action": "showSearchResult",
    "partNumber": "ATMEGA328P-PU"
  }
  ```

#### 8.2.2 料号查询请求
- **发送方**：内容脚本
- **接收方**：背景脚本
- **数据格式**：
  ```json
  {
    "action": "searchPart",
    "partNumber": "ATMEGA328P-PU"
  }
  ```

#### 8.2.3 查询结果响应
- **发送方**：背景脚本
- **接收方**：内容脚本
- **数据格式**：
  ```json
  {
    "success": true,
    "data": {
      "partNumber": "ATMEGA328P-PU",
      "alternatives": [...],
      "prices": [...],
      "riskInfo": {...}
    }
  }
  ```

## 9. 验收标准

### 9.1 功能验收标准

#### 9.1.1 料号查询功能
- ✅ 能够通过右键菜单选择网页中的料号进行查询
- ✅ 支持主流电子元器件料号格式
- ✅ 查询过程中显示加载状态
- ✅ 查询完成后展示结果弹窗

#### 9.1.2 替代料推荐功能
- ✅ 能够推荐至少3种类型的替代料（直接替代、参数等效、功能替代）
- ✅ 替代料信息包含型号、类型、来源和差异说明
- ✅ 推荐结果准确，符合行业认知

#### 9.1.3 跨平台价格比较功能
- ✅ 支持至少6个主流电子元器件平台
- ✅ 显示每个平台的价格、库存和交期信息
- ✅ 价格按从低到高排序
- ✅ 点击平台条目可跳转到对应平台产品页面

#### 9.1.4 风险评估功能
- ✅ 显示元器件的生命周期状态
- ✅ 显示RoHS合规状态
- ✅ 显示风险等级

### 9.2 非功能验收标准

#### 9.2.1 性能验收
- ✅ 查询响应时间<2秒
- ✅ 扩展加载时间<100ms
- ✅ 支持1000+并发请求

#### 9.2.2 可靠性验收
- ✅ 服务可用性>99.9%
- ✅ API调用错误率<0.1%
- ✅ 数据准确性>95%

#### 9.2.3 兼容性验收
- ✅ 支持Chrome 90+浏览器
- ✅ 支持Windows、macOS、Linux操作系统
- ✅ 自适应不同屏幕分辨率

### 9.3 界面验收标准
- ✅ 符合设计规范，视觉统一
- ✅ 交互流畅，反馈及时
- ✅ 响应式设计，适配不同屏幕尺寸
- ✅ 无明显UI缺陷或布局问题

### 9.4 代码验收标准
- ✅ 代码结构清晰，模块化设计
- ✅ 代码注释率>30%
- ✅ 无语法错误和运行时错误
- ✅ 符合JavaScript编码规范

## 10. 附录

### 10.1 术语定义
- **料号**：电子元器件的唯一标识符，通常由字母和数字组成
- **替代料**：可替代原元器件使用的其他型号或品牌的元器件
- **直接替代**：功能、参数、封装完全一致的替代料
- **参数等效**：主要参数一致，可兼容使用的替代料
- **功能替代**：功能类似，架构或封装不同的替代料
- **RoHS**：Restriction of Hazardous Substances，限制有害物质指令

### 10.2 参考文献
- Chrome扩展开发文档：https://developer.chrome.com/docs/extensions/
- Express框架文档：https://expressjs.com/
- RESTful API设计指南：https://restfulapi.net/

### 10.3 版本历史
| 版本号 | 修订日期 | 修订内容 | 修订人 |
|-------|---------|---------|-------|
| 1.0.0 | 2026-01-08 | 初始版本 | 开发团队 |

---

**文档审批**

| 角色 | 姓名 | 审批日期 | 审批意见 |
|------|------|---------|---------|
| 产品经理 | | | |
| 技术经理 | | | |
| 测试经理 | | | |
| 项目经理 | | | |
